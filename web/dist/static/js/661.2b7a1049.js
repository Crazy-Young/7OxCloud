"use strict";(self["webpackChunk_7OxCloud"]=self["webpackChunk_7OxCloud"]||[]).push([[661],{4246:function(t,e,i){i.d(e,{Z:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"data-status"},[!t.isDataEnd||t.loading?e("Loading",{ref:"loading"}):t.length?e("p",{staticClass:"no-more"},[t._v("暂时没有更多了")]):e("div",{staticClass:"no-data"},[e("el-empty",{attrs:{description:"暂无相关视频"}})],1)],1)},a=[],o=i(9884),n={name:"DataStatus",components:{Loading:o.Z},data(){return{observe:null}},props:{length:{type:Number,default:0},isDataEnd:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},mounted(){this.observe=new IntersectionObserver((t=>{t[0].isIntersecting&&this.$emit("getVideoList")}),{threshold:.3}),this.observe.observe(this.$refs.loading.$el)},beforeDestroy(){this.$refs.loading?.$el&&this.observe.unobserve(this.$refs.loading.$el)}},l=n,r=i(1001),d=(0,r.Z)(l,s,a,!1,null,"acf7796e",null),u=d.exports},9884:function(t,e,i){i.d(e,{Z:function(){return r}});var s=function(){var t=this;t._self._c;return t._m(0)},a=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"loading"},[e("div",{staticClass:"loading-img"}),e("p",{staticClass:"loading-text"},[t._v("加载中...")])])}],o=i(1001),n={},l=(0,o.Z)(n,s,a,!1,null,"5d0d0e96",null),r=l.exports},4366:function(t,e,i){i.d(e,{Z:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("span",{staticClass:"topic-item",style:{"--size":t.size+"px"}},[e("router-link",{attrs:{to:{name:"Topic",params:{tid:t.id}}}},[t._v("# "+t._s(t.description))])],1)},a=[],o={name:"Topic",props:{id:{type:Number|String,required:!0},description:{type:String,default:""},size:{type:Number,default:12}}},n=o,l=i(1001),r=(0,l.Z)(n,s,a,!1,null,"7b01258c",null),d=r.exports},1409:function(t,e,i){i.d(e,{Z:function(){return _}});var s=function(){var t=this,e=t._self._c;return e("article",{staticClass:"video"},[e("div",{staticClass:"video-content",style:{paddingTop:100*t.ratio+"%"},on:{mouseenter:t.handleMouseEnter,mouseleave:t.handleMouseLeave}},[e("XgPlayer",{ref:"video",staticClass:"video-content-xg",attrs:{playUrl:t.playUrl,coverUrl:t.coverUrl,ignores:["fullscreen","definition","i18n","cssfullscreen","playbackrate"],muted:"",vid:t.vid,ctrlpos:"bottom"}},[[e("div",{staticClass:"video-like-count"},[e("LikeHollowIcon"),t._v(" "+t._s(t.likeCount)+" ")],1),t.isDelete?e("div",{staticClass:"video-delete",on:{click:t.handleDelete}},[e("i",{staticClass:"el-icon-delete"})]):t._e()]],2)],1),e("div",{staticClass:"video-info"},[e("div",{staticClass:"video-info__header",class:{"fix-height":!t.waterfall}},[e("span",{staticClass:"desc"},[e("router-link",{staticClass:"title",attrs:{to:`/video/${t.vid}`}},[t._v(t._s(t.description))])],1),t._l(t.topics,(function(i){return e("Topic",t._b({key:i.id,staticClass:"topic"},"Topic",i,!1))}))],2),t.author?e("div",{staticClass:"video-info__footer"},[e("span",[e("router-link",{staticClass:"author",attrs:{to:{name:"User",params:{uid:t.author.uid}}}},[t._v(" @ "),e("span",[t._v(t._s(t.author.username))])]),e("span",[t._v(" · ")]),t.author.isFollow?e("span",{staticClass:"follow"},[t._v("已关注")]):e("span",{staticClass:"time"},[t._v(t._s(t.formatTime(t.publishTime)))])],1)]):t._e()])])},a=[],o=i(5675),n=i(4781),l=i(4366),r=function(){var t=this,e=t._self._c;return e("svg",{staticClass:"BnHuaqS7",attrs:{width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"}},[e("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.224 4.667C6.326 4.667 4 7.151 4 10.043l.002.169a1.078 1.078 0 00-.002.094c.009.387.097.855.195 1.245.096.382.23.806.38 1.113.605 1.301 1.664 2.563 2.683 3.6a30.679 30.679 0 003.425 3.008l.02.017.015.012c.226.226.703.7 1.554.7h.025c.241 0 .816-.001 1.331-.502.009-.008.022-.02.042-.035l.182-.151.004-.004c.565-.465 1.886-1.554 3.188-2.867.834-.836 1.698-1.807 2.359-2.81.09-.136.176-.273.258-.41.033-.055.06-.112.082-.17.03-.077.044-.108.055-.13.013-.025.034-.063.088-.146.038-.06.07-.122.096-.188.037-.093.064-.156.085-.199l.004-.009c.087-.11.152-.238.19-.374.162-.576.273-1.082.284-1.705 0-.03 0-.058-.002-.087a7.123 7.123 0 00.001-.206c-.019-2.876-2.338-5.341-5.224-5.341-1.094 0-2.159.339-2.999 1.021-.909-.658-1.957-1.021-3.097-1.021zm9.162 5.377v.134a2.388 2.388 0 000 .14c-.01.294-.057.559-.156.935-.043.07-.076.135-.1.186a4.313 4.313 0 00-.116.26c-.108.173-.178.31-.251.492-.05.082-.104.167-.16.252h-.001c-.55.834-1.304 1.69-2.087 2.476l-.003.002c-1.223 1.234-2.474 2.266-3.033 2.727l-.041.034c-.05.04-.105.086-.157.13l-.06-.061c-.065-.064-.154-.135-.197-.17l-.008-.006a28.517 28.517 0 01-3.214-2.817l-.003-.004c-.968-.985-1.824-2.042-2.27-3.009a4.077 4.077 0 01-.24-.719 4.491 4.491 0 01-.129-.715l.001-.036v-.098l-.001-.005-.002-.129c0-1.778 1.436-3.218 3.066-3.218.857 0 1.667.348 2.393 1.102a1.079 1.079 0 001.66-.129c.428-.61 1.155-.973 2.043-.973 1.63 0 3.066 1.441 3.066 3.218v.001z",fill:"#fff"}})])},d=[],u=i(1001),c={},h=(0,u.Z)(c,r,d,!1,null,null,null),f=h.exports,v=i(3822),p=i(2675),m={name:"VideoBox",data(){return{timer:null}},components:{XgPlayer:o.Z,Topic:l.Z,LikeHollowIcon:f},computed:{...(0,v.rn)({userInfo:t=>t.user.userInfo})},props:{vid:{type:String|Number},publishTime:{type:Number},playUrl:{type:String,default:()=>""},coverUrl:{type:String,default:()=>""},description:{type:String,default:"视频标题"},author:{type:Object,default:()=>{}},ratio:{type:Number,default:3/4},topics:{type:Array,default:()=>[]},waterfall:{type:Boolean,default:!0},likeCount:{type:Number,default:0},isDelete:{type:Boolean,default:!1}},methods:{formatTime:n.Z,play(){this.$refs.video.play()},pause(){this.$refs.video.pause()},handleMouseEnter(){this.timer=setTimeout((()=>{this.play()}),100)},handleMouseLeave(){clearTimeout(this.timer),this.pause()},handleDelete(){(0,p.Wq)(this.vid).then((t=>{200===t.status?(this.$message.success(t?.data?.msg),this.$emit("deleteVideo",this.vid)):this.$message.error(t?.data?.msg)}))}},beforeDestroy(){clearTimeout(this.timer),this.pause()}},g=m,y=(0,u.Z)(g,s,a,!1,null,"7541b632",null),_=y.exports},6951:function(t,e,i){i.r(e),i.d(e,{default:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("div",{ref:"home",staticClass:"home",attrs:{id:"home"}},[!t.loading||t.videoList.length>15?t._l(t.videoList,(function(i,s){return e("VideoBox",t._b({key:i.vid,ref:"VideoBox",refInFor:!0,staticClass:"video"},"VideoBox",i,!1))})):t._e()],2),e("DataStatus",{ref:"loading",attrs:{loading:t.loading,isDataEnd:t.isDataEnd,length:t.videoList.length},on:{getVideoList:t.getVideoList}})],1)},a=[],o=i(1409);function n(t,e=5,i=20){if(!t)return;t.style.position="relative";const s=t.getBoundingClientRect(),a=s.width,o=(a-(e-1)*i)/e,n=[];for(let r=0;r<e;r++)n[r]=0;const l=t.children;for(let r=0;r<l.length;r++)l[r].style.width=o+"px",l[r].style.position="absolute";for(let r=0;r<l.length;r++){const t=l[r],s=t.getBoundingClientRect(),a=s.height;let d=1/0,u=-1;for(let i=0;i<e;i++)n[i]<d&&(d=n[i],u=i);t.style.left=o*u+i*u+"px",t.style.top=n[u]+"px",n[u]+=a+i}t.style.height=Math.max(...n)+"px"}var l=i(2675),r=i(4246),d=i(6428),u=i(6171),c={name:"Home",mixins:[d.Z],components:{VideoBox:o.Z,DataStatus:r.Z},data(){return{loading:!1}},methods:{waterfallLayout:(0,u.Z)((function(){n(this.$refs.home,window.innerWidth<800?2:window.innerWidth<1280?3:window.innerWidth<1560?4:5,20)}),100,!0),async loadAllSources(){if(!this.loading){this.loading=!0;for(let t=0;t<this.videoList.length;t++){if(this.videoList[t].isLoaded)continue;const e=document.createElement("video");e.src=this.videoList[t].playUrl,await new Promise(((i,s)=>{e.onloadedmetadata=()=>{this.videoList[t].width=e.videoWidth,this.videoList[t].height=e.videoHeight,this.videoList[t].ratio=this.videoList[t].height/this.videoList[t].width,this.videoList[t].isLoaded=!0,i()},e.onerror=()=>{i()}})),e.remove()}this.loading=!1,this.$nextTick((()=>{this.waterfallLayout()}))}},async getVideoList(){await this.reqVideoList((()=>(0,l.Ku)(this.latestTime))),await this.loadAllSources()}},mounted(){window.addEventListener("resize",this.waterfallLayout)},beforeDestroy(){window.removeEventListener("resize",this.waterfallLayout)}},h=c,f=i(1001),v=(0,f.Z)(h,s,a,!1,null,"55eb2000",null),p=v.exports},6428:function(t,e,i){i(7658);e["Z"]={data(){return{videoList:[],latestTime:null,isDataEnd:!1,isRequestData:!1}},methods:{async reqVideoList(t){try{if(this.isRequestData||this.isDataEnd)return;this.isRequestData=!0;const e=await t();if(!e)return;if(200!==e.status)return void this.$message.error(e.data.msg);this.videoList.push(...e.data.data.videos||[]),this.latestTime=e.data.data.nextTime,(e.data.data.videos.length<15||!e.data.data.nextTime)&&(this.isDataEnd=!0),this.isRequestData=!1}catch(e){this.$message.error(e),this.isDataEnd=!0,this.isRequestData=!1}}}}},6171:function(t,e,i){function s(t,e=300,i=!1){let s=null,a=!1;const o=function(...o){s&&clearTimeout(s),i&&!a?(t.apply(this,o),a=!0):s=setTimeout((()=>{t.apply(this,o),a=!1}),e)};return o}i.d(e,{Z:function(){return s}})}}]);