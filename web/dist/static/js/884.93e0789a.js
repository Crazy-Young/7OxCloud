"use strict";(self["webpackChunk_7OxCloud"]=self["webpackChunk_7OxCloud"]||[]).push([[884],{3684:function(t,e,s){s.d(e,{Z:function(){return l}});var a=function(){var t=this,e=t._self._c;return e("svg",{staticClass:"FhOy97Hs",attrs:{width:"18",height:"18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.875 1.5a6.375 6.375 0 103.642 11.608l3.063 3.063a1.125 1.125 0 001.59-1.591l-3.062-3.063A6.375 6.375 0 007.875 1.5zM3.75 7.875a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0z",fill:"#4F5168"}})])},i=[],o=s(1001),n={},r=(0,o.Z)(n,a,i,!1,null,null,null),l=r.exports},9880:function(t,e,s){s.r(e),s.d(e,{default:function(){return V}});var a=function(){var t=this,e=t._self._c;return e("el-container",[e("header",[e("el-avatar",{attrs:{size:120,src:t.userInfo.avatar}},[t._v(t._s(t.userInfo.username||"未登录"))]),e("div",{staticClass:"userInfo"},[e("h1",{staticClass:"username"},[t._v(t._s(t.userInfo.username||"未登录"))]),e("p",{staticClass:"list",on:{click:function(e){t.isShowFollowList=!0}}},[e("span",[t._v("关注")]),e("i",[t._v(t._s(t.userInfo.uid?t.userInfo.followCount:"-"))]),e("el-divider",{attrs:{direction:"vertical"}}),e("span",[t._v("粉丝")]),e("i",[t._v(t._s(t.userInfo.uid?t.userInfo.fanCount:"-"))]),e("el-divider",{attrs:{direction:"vertical"}}),e("span",[t._v("获赞")]),e("i",[t._v(t._s(t.userInfo.uid?t.userInfo.likedCount:"-"))])],1),t.userInfo.uid?e("p",{staticClass:"other"},[e("span",{staticClass:"account"},[t._v("账号ID: "+t._s(t.userInfo.uid))]),e("span",{staticClass:"gender tag"},[e("GenderIcon",{attrs:{gender:t.userInfo.gender}}),e("span",[t._v(t._s(t.userInfo.age)+"岁")])],1),e("span",{staticClass:"location tag"},[t._v(" "+t._s(t.userInfo.location))])]):t._e(),e("p",{staticClass:"signature",attrs:{title:t.userInfo.signature}},[t._v(t._s(t.userInfo.signature))])]),t.userInfo.uid?e("div",{staticClass:"tool"},[e("el-button",{on:{click:function(e){t.isChange=!0}}},[t._v("编辑资料")]),e("el-button",{attrs:{type:"danger"},on:{click:t.logout}},[t._v("退出登录")])],1):t._e()],1),e("main",[e("el-tabs",{model:{value:t.activeChoice,callback:function(e){t.activeChoice=e},expression:"activeChoice"}},[e("el-tab-pane",{staticClass:"video-container",attrs:{disabled:!t.userInfo.uid,label:`作品 ${t.userInfo.uid?t.userInfo.workCount:""}`,name:"work"}}),e("el-tab-pane",{staticClass:"video-container",attrs:{disabled:!t.userInfo.uid,label:`喜欢 ${t.userInfo.likeCount||""}`,name:"like"}}),e("el-tab-pane",{staticClass:"video-container",attrs:{disabled:!t.userInfo.uid,label:`收藏 ${t.userInfo.collectCount||""}`,name:"collect"}}),e("el-tab-pane",{staticClass:"video-container",attrs:{disabled:!t.userInfo.uid,label:`观看历史 ${t.userInfo.historyCount||""}`,name:"history"}})],1),e("div",{staticClass:"video-container"},t._l(t.videoList,(function(s){return e("VideoBox",t._b({key:s.vid,attrs:{ratio:4/3,waterfall:!1,isDelete:"work"===t.activeChoice},on:{deleteVideo:t.deleteVideo}},"VideoBox",s,!1))})),1),t.userInfo.uid?e("DataStatus",{ref:"loading",attrs:{isDataEnd:t.isDataEnd,length:t.videoList.length},on:{getVideoList:t.getVideoList}}):e("el-empty",{attrs:{description:"点击右上角按钮进行登录","image-size":180}})],1),t.isChange?e("ChangeInfo",{on:{close:function(e){t.isChange=!1}}}):t._e(),t.isShowFollowList?e("FollowList",{on:{close:t.handleFollowListClose}}):t._e()],1)},i=[],o=s(3822),n=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"change-info"}},[e("div",{staticClass:"mask",on:{click:function(e){return t.$emit("close")}}}),e("div",{staticClass:"panel"},[e("div",{staticClass:"panel-close",on:{click:function(e){return t.$emit("close")}}}),t._m(0),e("div",{staticClass:"panel-content"},[e("el-form",{ref:"form",attrs:{model:t.form,"show-message":!1,"label-position":"top"}},[e("el-form-item",{attrs:{prop:"avatar"}},[e("label",{staticClass:"avatar",attrs:{for:"avatar"}},[e("img",{attrs:{src:t.form.avatar,alt:""}}),e("div",{staticClass:"avatar-mask"})]),e("input",{attrs:{type:"file",accept:"image/*",name:"avatar",id:"avatar"},on:{change:t.changeAvatar}})]),e("el-form-item",{attrs:{prop:"username",label:"昵称"}},[e("el-input",{attrs:{placeholder:t.userInfo.username,maxlength:"20"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}},[e("template",{slot:"append"},[e("span",{staticClass:"count"},[t._v(t._s(t.form.username.length)+"/20")])])],2)],1),e("el-form-item",{attrs:{prop:"age",label:"年龄"}},[e("el-input",{attrs:{placeholder:t.userInfo.age,type:"number",min:0,step:1,max:100},on:{input:t.limitAge},model:{value:t.form.age,callback:function(e){t.$set(t.form,"age",t._n(e))},expression:"form.age"}})],1),e("el-form-item",{attrs:{prop:"gender",label:"性别"}},[e("el-select",{attrs:{placeholder:"选择性别"},model:{value:t.form.gender,callback:function(e){t.$set(t.form,"gender",e)},expression:"form.gender"}},[e("el-option",{attrs:{label:"男",value:"1"}}),e("el-option",{attrs:{label:"女",value:"0"}})],1)],1),e("el-form-item",{attrs:{prop:"location",label:"地区"}},[e("el-input",{attrs:{placeholder:t.userInfo.location,maxlength:"20"},model:{value:t.form.location,callback:function(e){t.$set(t.form,"location",e)},expression:"form.location"}})],1),e("el-form-item",{attrs:{prop:"signature",label:"简介"}},[e("el-input",{attrs:{placeholder:t.userInfo.signature,maxlength:"200",type:"textarea",resize:"none",rows:4},model:{value:t.form.signature,callback:function(e){t.$set(t.form,"signature",e)},expression:"form.signature"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("form")}}},[t._v("保存")]),e("el-button",{attrs:{type:"info"},on:{click:function(e){return t.$emit("close")}}},[t._v("取消")])],1)],1)],1)])])},r=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"panel__header"},[e("div",{staticClass:"panel__header-title"},[t._v("编辑资料")])])}],l=s(7389),c={name:"ChangeInfo",data(){return{form:{username:"",signature:"",avatar:"",location:"",gender:"",age:0},file:null}},methods:{limitAge(){this.form.age>100?this.form.age=100:this.form.age<0&&(this.form.age=0)},submitForm(t){this.$refs[t].validate(((t,e)=>{if(t)if(this.file){const t=new FormData;t.append("file",this.file),(0,l.G1)(t).then((t=>{if(200!==t.status)throw new Error(t.data.msg);return(0,l.Yx)(this.userInfo.avatar),this.form.avatar=t.data.data,this.$store.dispatch("UserUpdate",{username:this.form.username||this.userInfo.username,signature:this.form.signature||this.userInfo.signature,avatar:this.form.avatar||this.userInfo.avatar,location:this.form.location||this.userInfo.location,gender:this.form.gender||this.userInfo.gender,age:this.form.age||this.userInfo.age})})).then((t=>{this.$emit("close")})).catch((t=>{this.$message.error(t)}))}else this.$store.dispatch("UserUpdate",{username:this.form.username||this.userInfo.username,signature:this.form.signature||this.userInfo.signature,avatar:this.form.avatar||this.userInfo.avatar,location:this.form.location||this.userInfo.location,gender:this.form.gender.toString()||this.userInfo.gender.toString(),age:this.form.age||this.userInfo.age}).then((t=>{this.$emit("close")}))}))},changeAvatar(t){const e=t.target.files[0];this.file=e,this.form.avatar=URL.createObjectURL(e)}},computed:{...(0,o.rn)({userInfo:t=>t.user.userInfo})},mounted(){this.form.username=this.userInfo.username,this.form.signature=this.userInfo.signature,this.form.avatar=this.userInfo.avatar,this.form.location=this.userInfo.location,this.form.gender=this.userInfo.gender.toString(),this.form.age=this.userInfo.age}},u=c,f=s(1001),d=(0,f.Z)(u,n,r,!1,null,"2e18eeb5",null),h=d.exports,m=s(2675),v=s(1409),p=s(6428),g=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"follow-list"}},[e("div",{staticClass:"mask",on:{click:function(e){return t.$emit("close")}}}),e("div",{staticClass:"panel"},[e("div",{staticClass:"panel-close",on:{click:function(e){return t.$emit("close")}}}),e("div",{staticClass:"panel__header"},[e("div",{staticClass:"panel__header-title",class:{active:0===t.activeIndex},on:{click:function(e){t.activeIndex=0}}},[t._v("关注("+t._s(t.m_followCount)+")")]),e("div",{staticClass:"panel__header-title",class:{active:1===t.activeIndex},on:{click:function(e){t.activeIndex=1}}},[t._v("粉丝("+t._s(t.m_fanCount)+")")])]),e("div",{staticClass:"panel__search"},[e("el-input",{attrs:{clearable:"",placeholder:"搜索"},on:{input:t.handleSearch},scopedSlots:t._u([{key:"prefix",fn:function(){return[e("search-icon")]},proxy:!0}]),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e("div",{staticClass:"panel-content"},t._l(0===t.activeIndex?t.followList:t.fanList,(function(s){return e("div",{key:s.id||s.uid,staticClass:"list-item"},[e("router-link",{attrs:{to:`/user/${s.id||s.uid}`}},[e("el-avatar",{attrs:{size:60,src:s.avatar}})],1),e("div",{staticClass:"info"},[e("p",{staticClass:"name"},[e("router-link",{attrs:{to:`/user/${s.id||s.uid}`}},[t._v(t._s(s.username))])],1),e("p",{staticClass:"desc"},[t._v(t._s(s.signature))])]),e("el-button",{staticClass:"btn",class:{active:s.isFollow},on:{click:function(e){return t.handleFollow(s)}}},[t._v(" "+t._s(s.isFollow&&s.isFan?"互相关注":s.isFollow?"已关注":s.isFan?"回关":"关注")+" ")]),1===t.activeIndex?e("el-button",{staticClass:"btn active",on:{click:function(e){return t.handleRemoveFan(s)}}},[t._v("移除")]):t._e()],1)})),0)])])},_=[],C=s(3684),I=s(2900),w=s(6171),b={name:"FollowList",components:{SearchIcon:C.Z},computed:{...(0,o.rn)({followList:t=>t.user.followList,fanList:t=>t.user.fanList}),...(0,o.Se)({followCount:"followCount",fanCount:"fanCount"})},data(){return{activeIndex:0,search:"",m_followCount:0,m_fanCount:0}},created(){this.m_followCount=this.followCount,this.m_fanCount=this.fanCount},methods:{handleFollow(t){(0,I.Zz)({userId:t.id||t.uid,type:t.isFollow?2:1}).then((e=>{200===e.status?(t.isFollow=!t.isFollow,this.m_followCount+=t.isFollow?1:-1,this.handleSearch()):this.$message.error(e.data.msg)}))},handleRemoveFan(t){(0,I.In)(t.id||t.uid).then((t=>{200===t.status?(this.m_fanCount-=1,this.handleSearch()):this.$message.error(t.data.msg)}))},handleSearch:(0,w.Z)((function(){this.search.trim()?0===this.activeIndex?(0,I.fo)(this.search).then((t=>{200===t.status?this.$store.commit("SET_USER_FOLLOW",t.data.data):this.$message.error(t.data.msg)})):(0,I.XX)(this.search).then((t=>{200===t.status?this.$store.commit("SET_USER_FAN",t.data.data):this.$message.error(t.data.msg)})):(this.$store.dispatch("UserFollowList"),this.$store.dispatch("UserFanList"))}))}},k=b,L=(0,f.Z)(k,g,_,!1,null,"4c94cc4d",null),x=L.exports,F=s(8495),$=s(4246),S={name:"Me",mixins:[p.Z],components:{ChangeInfo:h,FollowList:x,VideoBox:v.Z,GenderIcon:F.Z,DataStatus:$.Z},computed:{...(0,o.rn)({userInfo:t=>t.user.userInfo})},data(){return{activeChoice:"work",isChange:!1,isShowFollowList:!1}},methods:{init(){this.isDataEnd=!1,this.videoList=[],this.latestTime=null},getData(){this.init(),this.getVideoList()},logout(){this.$store.dispatch("UserLogout")},getVideoList:(0,w.Z)((function(){switch(this.activeChoice){case"work":this.reqVideoList((()=>(0,m.ZC)(this.userInfo.uid,this.latestTime)));break;case"like":this.reqVideoList((()=>(0,m.jf)(this.userInfo.uid,this.latestTime)));break;case"collect":this.reqVideoList((()=>(0,m.ir)(this.userInfo.uid,this.latestTime)));break;case"history":this.reqVideoList((()=>(0,m.pe)(this.latestTime)));break}}),100),deleteVideo(t){this.videoList=this.videoList.filter((e=>e.vid!==t))},getUserInfo(){this.$store.dispatch("UserInfo")},handleFollowListClose(){this.isShowFollowList=!1}},watch:{activeChoice(t,e){t!==e&&this.getData()},isShowFollowList(){this.getUserInfo()}},mounted(){this.getUserInfo(),document.querySelector("#app > section > section > main").onscroll=this.getVideoList},beforeDestroy(){document.querySelector("#app > section > section > main").onscroll=null}},y=S,U=(0,f.Z)(y,a,i,!1,null,"62b3e93a",null),V=U.exports},6171:function(t,e,s){function a(t,e=300,s=!1){let a=null,i=!1;const o=function(...o){a&&clearTimeout(a),s&&!i?(t.apply(this,o),i=!0):a=setTimeout((()=>{t.apply(this,o),i=!1}),e)};return o}s.d(e,{Z:function(){return a}})}}]);